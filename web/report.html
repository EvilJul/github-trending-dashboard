<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ¥å‘Šè¯¦æƒ… - GitHub Trending Projects</title>
    <style>
        :root {
            --primary-color: #2d3748;
            --secondary-color: #4a5568;
            --accent-color: #3182ce;
            --accent-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --light-color: #f7fafc;
            --dark-color: #1a202c;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--primary-color), var(--dark-color));
            color: var(--light-color);
            min-height: 100vh;
            padding: 20px;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        body.loaded {
            opacity: 1;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Header */
        header {
            text-align: center;
            padding: 30px 0;
            margin-bottom: 30px;
            animation: fadeInDown 0.6s ease forwards;
        }

        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 10px;
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: #a0aec0;
            font-size: 1rem;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
            margin-bottom: 20px;
            padding: 10px 20px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .back-link:hover {
            background: rgba(102, 126, 234, 0.2);
            transform: translateX(-5px);
        }

        /* Navigation */
        .nav-bar {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            animation: fadeIn 0.6s ease 0.2s forwards;
            opacity: 0;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .nav-btn {
            padding: 10px 25px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: transparent;
            color: var(--light-color);
            cursor: pointer;
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .nav-btn.secondary {
            background: var(--accent-gradient);
            border-color: transparent;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(26, 32, 44, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-3px);
            border-color: #667eea;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 600;
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            color: #a0aec0;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        /* Section */
        .section {
            margin-bottom: 40px;
            animation: fadeInUp 0.6s ease forwards;
            opacity: 0;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .section-title {
            font-size: 1.5rem;
            color: #667eea;
        }

        /* Project Cards */
        .projects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
        }

        .project-card {
            background: rgba(26, 32, 44, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .project-card:hover {
            transform: translateY(-5px);
            border-color: #667eea;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.2);
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .project-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: #667eea;
            text-decoration: none;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .project-name:hover {
            text-decoration: underline;
        }

        .trend-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .trend-badge.rising {
            background: rgba(72, 187, 120, 0.2);
            color: #48bb78;
        }

        .trend-badge.falling {
            background: rgba(245, 101, 101, 0.2);
            color: #f56565;
        }

        .trend-badge.stable, .trend-badge.steady {
            background: rgba(49, 130, 206, 0.2);
            color: #3182ce;
        }

        .project-description {
            color: #cbd5e0;
            line-height: 1.6;
            margin-bottom: 15px;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .project-meta {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 5px;
            color: #a0aec0;
            font-size: 0.9rem;
        }

        .meta-value {
            font-weight: 600;
            color: var(--light-color);
        }

        .language-tag {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .language-tag.java { background: rgba(198, 120, 66, 0.2); color: #e6915a; }
        .language-tag.python { background: rgba(55, 118, 171, 0.2); color: #5fa8e6; }
        .language-tag.typescript { background: rgba(49, 120, 198, 0.2); color: #3178c6; }
        .language-tag.javascript { background: rgba(247, 223, 30, 0.2); color: #f7df1e; }
        .language-tag.go { background: rgba(0, 173, 216, 0.2); color: #00add8; }
        .language-tag.rust { background: rgba(230, 100, 60, 0.2); color: #e6643c; }
        .language-tag.cpp, .language-tag.c { background: rgba(0, 100, 200, 0.2); color: #00599c; }
        .language-tag.other { background: rgba(158, 158, 158, 0.2); color: #bdbdbd; }

        .usage-steps {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .usage-steps h4 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 0.95rem;
        }

        .steps-list {
            list-style: none;
        }

        .steps-list li {
            padding: 5px 0;
            color: #e2e8f0;
            position: relative;
            padding-left: 20px;
            font-size: 0.85rem;
            line-height: 1.5;
        }

        .steps-list li::before {
            content: "â–¶";
            position: absolute;
            left: 0;
            color: #667eea;
            font-size: 0.7rem;
        }

        .category-tag {
            display: inline-block;
            padding: 3px 10px;
            background: rgba(102, 126, 234, 0.2);
            color: #667eea;
            border-radius: 12px;
            font-size: 0.8rem;
            margin-top: 10px;
        }

        /* Loading */
        .loading-container {
            text-align: center;
            padding: 60px 20px;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error-message {
            text-align: center;
            padding: 60px 20px;
            color: #f56565;
        }

        /* Footer */
        .footer-info {
            text-align: center;
            padding: 30px;
            color: #a0aec0;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 40px;
        }

        @media (max-width: 768px) {
            .projects-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .section-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“‹ æŠ¥å‘Šè¯¦æƒ…</h1>
            <p class="subtitle" id="report-subtitle">GitHub Trending é¡¹ç›®æŠ¥å‘Š</p>
        </header>

        <nav class="nav-bar">
            <a href="index.html" class="nav-btn secondary">ğŸ“Š çƒ­é—¨é¡¹ç›®</a>
            <a href="history.html" class="nav-btn">ğŸ“‹ å†å²è®°å½•</a>
        </nav>

        <a href="history.html" class="back-link">â† è¿”å›å†å²è®°å½•</a>

        <main id="report-container">
            <div class="loading-container">
                <div class="loading-spinner"></div>
                <p class="loading-text">æ­£åœ¨åŠ è½½æŠ¥å‘Šæ•°æ®...</p>
            </div>
        </main>

        <footer class="footer-info">
            <p>ğŸ“… æŠ¥å‘Šç”Ÿæˆæ—¶é—´: <span id="report-date">-</span></p>
            <p>ğŸ”„ Powered by Clawdbot</p>
        </footer>
    </div>

    <script>
        class ReportDetail {
            constructor() {
                this.reportId = this.getReportId();
                this.reportData = null;
                this.init();
            }

            getReportId() {
                const params = new URLSearchParams(window.location.search);
                return params.get('id') || '';
            }

            async init() {
                await this.loadReportData();
                this.renderReport();
            }

            async loadReportData() {
                if (!this.reportId) {
                    this.showError('ç¼ºå°‘æŠ¥å‘ŠID');
                    return;
                }

                try {
                    // å…ˆå°è¯•ä»å½“å‰å†å²è®°å½•åˆ—è¡¨ä¸­æŸ¥æ‰¾
                    const historyResponse = await fetch('/api/history/');
                    if (historyResponse.ok) {
                        const historyData = await historyResponse.json();
                        const history = historyData.history || [];
                        
                        // æŸ¥æ‰¾åŒ¹é…çš„è®°å½•
                        const record = history.find(h => h.id === this.reportId);
                        if (record) {
                            this.reportData = record;
                            document.getElementById('report-subtitle').textContent = 
                                this.reportData.week || `æŠ¥å‘Š #${this.reportId}`;
                            return;
                        }
                    }
                    
                    // å¦‚æœæ²¡æ‰¾åˆ°ï¼Œå°è¯•ç›´æ¥è°ƒç”¨ API
                    const response = await fetch(`/api/history/${this.reportId}`);
                    if (response.ok) {
                        this.reportData = await response.json();
                        document.getElementById('report-subtitle').textContent = 
                            this.reportData.week || `æŠ¥å‘Š #${this.reportId}`;
                    } else {
                        this.showError('æŠ¥å‘Šä¸å­˜åœ¨æˆ–å·²è¢«åˆ é™¤');
                    }
                } catch (error) {
                    console.warn('åŠ è½½æŠ¥å‘Šæ•°æ®å¤±è´¥:', error);
                    this.showError('åŠ è½½å¤±è´¥: ' + error.message);
                }
            }

            async loadFromHistoryList() {
                try {
                    const response = await fetch('/api/history/');
                    if (response.ok) {
                        const data = await response.json();
                        const history = data.history || [];
                        const record = history.find(h => h.id === this.reportId);
                        
                        if (record) {
                            this.reportData = record;
                            // å°è¯•è·å–å®Œæ•´é¡¹ç›®è¯¦æƒ…
                            await this.enrichProjectsWithDetails();
                        } else {
                            this.showError('æŠ¥å‘Šä¸å­˜åœ¨');
                        }
                    } else {
                        this.showError('æ— æ³•åŠ è½½å†å²è®°å½•');
                    }
                } catch (error) {
                    this.showError('åŠ è½½å¤±è´¥: ' + error.message);
                }
            }

            async enrichProjectsWithDetails() {
                // è·å–å®Œæ•´é¡¹ç›®åˆ—è¡¨ï¼Œä»projects.jsonä¸­åŒ¹é…è¯¦ç»†ä¿¡æ¯
                try {
                    const response = await fetch('/api/projects/');
                    if (response.ok) {
                        const data = await response.json();
                        const projects = data.projects || [];
                        
                        // åˆ›å»ºé¡¹ç›®è¯¦æƒ…æ˜ å°„
                        const projectMap = {};
                        projects.forEach(p => {
                            projectMap[p.full_name] = p;
                            projectMap[p.name] = p;
                        });

                        // ä¸ºå†å²è®°å½•ä¸­çš„é¡¹ç›®è¡¥å……è¯¦æƒ…
                        if (this.reportData.projects && Array.isArray(this.reportData.projects)) {
                            this.reportData.projects = this.reportData.projects.map(name => {
                                // å¦‚æœå·²ç»æ˜¯å¯¹è±¡ï¼ˆå®Œæ•´è¯¦æƒ…ï¼‰ï¼Œç›´æ¥è¿”å›
                                if (typeof name === 'object') return name;
                                
                                // å¦åˆ™å°è¯•æŸ¥æ‰¾è¯¦æƒ…
                                const detail = projectMap[name] || projectMap[name.split('/')[1]];
                                return detail || { 
                                    name: name, 
                                    full_name: name,
                                    description: 'æš‚æ— æè¿°',
                                    stars: 0,
                                    forks: 0,
                                    language: 'Other',
                                    category: 'æœªçŸ¥åˆ†ç±»',
                                    usage_steps: ['è¯·è®¿é—®é¡¹ç›®é¡µé¢æŸ¥çœ‹è¯¦æƒ…']
                                };
                            });
                        }
                    }
                } catch (error) {
                    console.warn('æ— æ³•è·å–é¡¹ç›®è¯¦æƒ…:', error);
                }
            }

            showError(message) {
                const container = document.getElementById('report-container');
                container.innerHTML = `
                    <div class="error-message">
                        <h3>âŒ ${message}</h3>
                        <p>è¯·è¿”å›å†å²è®°å½•é¡µé¢é‡æ–°é€‰æ‹©</p>
                    </div>
                `;
            }

            formatNumber(num) {
                if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
                if (num >= 1000) return (num / 1000).toFixed(1) + 'k';
                return num.toString();
            }

            getTrendBadge(trend) {
                const icons = { 'rising': 'â†—ï¸', 'falling': 'â†˜ï¸', 'steady': 'â¡ï¸', 'stable': 'âœ…' };
                const labels = { 'rising': 'ä¸Šå‡', 'falling': 'ä¸‹é™', 'steady': 'ç¨³å®š', 'stable': 'çƒ­é—¨' };
                return `<span class="trend-badge trend-${trend}">${icons[trend] || ''} ${labels[trend] || trend}</span>`;
            }

            getLanguageClass(language) {
                const langMap = {
                    'Java': 'java', 'Python': 'python', 'TypeScript': 'typescript',
                    'JavaScript': 'javascript', 'Go': 'go', 'Rust': 'rust',
                    'C++': 'cpp', 'C': 'c', 'Shell': 'other'
                };
                return langMap[language] || 'other';
            }

            renderReport() {
                const container = document.getElementById('report-container');
                
                if (!this.reportData) {
                    this.showError('æŠ¥å‘Šæ•°æ®ä¸ºç©º');
                    return;
                }

                const projects = this.reportData.projects || [];
                const date = this.reportData.date || '-';
                
                document.getElementById('report-date').textContent = date;

                // è®¡ç®—ç»Ÿè®¡æ•°æ®
                const totalStars = projects.reduce((sum, p) => sum + (p.stars || 0), 0);
                const totalForks = projects.reduce((sum, p) => sum + (p.forks || 0), 0);
                const topProject = projects.sort((a, b) => (b.stars || 0) - (a.stars || 0))[0];

                // è¯­è¨€åˆ†å¸ƒ
                const langCount = {};
                projects.forEach(p => {
                    const lang = p.language || 'Other';
                    langCount[lang] = (langCount[lang] || 0) + 1;
                });

                container.innerHTML = `
                    <!-- ç»Ÿè®¡å¡ç‰‡ -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value">${projects.length}</div>
                            <div class="stat-label">æ”¶å½•é¡¹ç›®</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${this.formatNumber(totalStars)}</div>
                            <div class="stat-label">æ€» Stars</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${this.formatNumber(totalForks)}</div>
                            <div class="stat-label">æ€» Forks</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${Object.keys(langCount).length}</div>
                            <div class="stat-label">è¯­è¨€ç§ç±»</div>
                        </div>
                    </div>

                    <!-- äº®ç‚¹é¡¹ç›® -->
                    ${topProject ? `
                    <div class="section" style="animation-delay: 0.1s;">
                        <div class="section-header">
                            <h2 class="section-title">ğŸ† æœ¬æœŸæœ€ä½³é¡¹ç›®</h2>
                        </div>
                        <div class="project-card" style="border-color: #667eea;">
                            <div class="card-header">
                                <a href="${topProject.url || '#'}" target="_blank" class="project-name">
                                    ${topProject.full_name || topProject.name}
                                </a>
                                ${this.getTrendBadge(topProject.trend)}
                            </div>
                            <p class="project-description">${topProject.description || 'æš‚æ— æè¿°'}</p>
                            <div class="project-meta">
                                <div class="meta-item">
                                    <span>â­</span>
                                    <span class="meta-value">${this.formatNumber(topProject.stars)}</span>
                                </div>
                                <div class="meta-item">
                                    <span>ğŸ´</span>
                                    <span class="meta-value">${this.formatNumber(topProject.forks)}</span>
                                </div>
                                <div class="meta-item">
                                    <span>ğŸ</span>
                                    <span class="meta-value">${topProject.language || 'Other'}</span>
                                </div>
                            </div>
                            <span class="language-tag ${this.getLanguageClass(topProject.language)}">${topProject.language || 'Other'}</span>
                            <span class="category-tag">${topProject.category || 'é€šç”¨å·¥å…·'}</span>
                        </div>
                    </div>
                    ` : ''}

                    <!-- å…¨éƒ¨é¡¹ç›®åˆ—è¡¨ -->
                    <div class="section" style="animation-delay: 0.2s;">
                        <div class="section-header">
                            <h2 class="section-title">ğŸ“¦ å…¨éƒ¨é¡¹ç›® (${projects.length})</h2>
                        </div>
                        <div class="projects-grid">
                            ${projects.map((project, index) => `
                                <div class="project-card" style="animation-delay: ${index * 0.05}s;">
                                    <div class="card-header">
                                        <a href="project.html?project=${encodeURIComponent(project.name)}" class="project-name">
                                            ${project.full_name || project.name}
                                        </a>
                                        ${this.getTrendBadge(project.trend)}
                                    </div>
                                    <p class="project-description">${project.description || 'æš‚æ— æè¿°'}</p>
                                    <div class="project-meta">
                                        <div class="meta-item">
                                            <span>â­</span>
                                            <span class="meta-value">${this.formatNumber(project.stars)}</span>
                                        </div>
                                        <div class="meta-item">
                                            <span>ğŸ´</span>
                                            <span class="meta-value">${this.formatNumber(project.forks)}</span>
                                        </div>
                                        <div class="meta-item">
                                            <span>ğŸ</span>
                                            <span class="meta-value">${project.language || 'Other'}</span>
                                        </div>
                                    </div>
                                    <span class="language-tag ${this.getLanguageClass(project.language)}">${project.language || 'Other'}</span>
                                    <span class="category-tag">${project.category || 'é€šç”¨å·¥å…·'}</span>
                                    
                                    ${project.usage_steps && project.usage_steps.length > 0 ? `
                                    <div class="usage-steps">
                                        <h4>ğŸ”§ ä½¿ç”¨æŒ‡å—</h4>
                                        <ul class="steps-list">
                                            ${project.usage_steps.slice(0, 3).map(step => `<li>${step}</li>`).join('')}
                                        </ul>
                                    </div>
                                    ` : ''}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            document.body.classList.add('loaded');
            new ReportDetail();
        });
    </script>
</body>
</html>
